import{d as D,r as p,k as V,o as R,c as E,b as z,e,w as l,f as u,g as r,E as d,h as I,i as c,j as g}from"./index-BAVvkMCM.js";const $=D({__name:"Storage",setup(M){const s=p("clients"),y=p([]),C=p([]),v=p([]),f=async()=>{try{const t=await r.getStoredClients();y.value=t.data||[]}catch(t){d.error("获取客户端数据失败: "+t.message)}},m=async()=>{try{const t=await r.getStoredSubscriptions();C.value=t.data||[]}catch(t){d.error("获取订阅数据失败: "+t.message)}},b=async()=>{try{const t=await r.getStoredRetained();v.value=t.data||[]}catch(t){d.error("获取保留消息败: "+t.message)}},x=()=>{s.value==="clients"&&f(),s.value==="subscriptions"&&m(),s.value==="retained"&&b()};V(s,x);const S=t=>{g.confirm("确定要删除该客户端记录吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await r.deleteStoredClient(t),d.success("已删除"),f()})},k=(t,a)=>{g.confirm("确定要删除该订阅记录吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await r.deleteStoredSubscription(t,a),d.success("已删除"),m()})},B=t=>{g.confirm("确定要删除该保留消息吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await r.deleteStoredRetained(t),d.success("已删除"),b()})};return R(x),(t,a)=>{const n=u("el-table-column"),i=u("el-button"),w=u("el-table"),_=u("el-tab-pane"),T=u("el-tabs");return I(),E("div",null,[a[7]||(a[7]=z("h2",null,"持久化数据管理",-1)),e(T,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=o=>s.value=o)},{default:l(()=>[e(_,{label:"客户端 (Clients)",name:"clients"},{default:l(()=>[e(w,{data:y.value,style:{width:"100%"}},{default:l(()=>[e(n,{prop:"id",label:"客户端 ID",width:"180"}),e(n,{prop:"remote",label:"远程地址",width:"180"}),e(n,{prop:"username",label:"用户名"}),e(n,{prop:"clean",label:"清除会话 (Clean Session)"}),e(n,{fixed:"right",label:"操作",width:"120"},{default:l(o=>[e(i,{type:"danger",size:"small",onClick:h=>S(o.row.id)},{default:l(()=>[...a[1]||(a[1]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(i,{style:{"margin-top":"10px"},onClick:f},{default:l(()=>[...a[2]||(a[2]=[c("刷新",-1)])]),_:1})]),_:1}),e(_,{label:"订阅 (Subscriptions)",name:"subscriptions"},{default:l(()=>[e(w,{data:C.value,style:{width:"100%"}},{default:l(()=>[e(n,{prop:"client",label:"客户端 ID",width:"180"}),e(n,{prop:"filter",label:"订阅主题 (Filter)"}),e(n,{prop:"qos",label:"QoS",width:"100"}),e(n,{fixed:"right",label:"操作",width:"120"},{default:l(o=>[e(i,{type:"danger",size:"small",onClick:h=>k(o.row.client,o.row.filter)},{default:l(()=>[...a[3]||(a[3]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(i,{style:{"margin-top":"10px"},onClick:m},{default:l(()=>[...a[4]||(a[4]=[c("刷新",-1)])]),_:1})]),_:1}),e(_,{label:"保留消息 (Retained)",name:"retained"},{default:l(()=>[e(w,{data:v.value,style:{width:"100%"}},{default:l(()=>[e(n,{prop:"topic_name",label:"主题"}),e(n,{prop:"client",label:"发布者 ID",width:"180"}),e(n,{fixed:"right",label:"操作",width:"120"},{default:l(o=>[e(i,{type:"danger",size:"small",onClick:h=>B(o.row.topic_name)},{default:l(()=>[...a[5]||(a[5]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(i,{style:{"margin-top":"10px"},onClick:b},{default:l(()=>[...a[6]||(a[6]=[c("刷新",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{$ as default};
