import{d as M,r as S,a as v,o as B,c as I,e as l,w as n,f as i,g as u,E as _,h as y,l as N,m as U,n as D,i as b,t as p,b as w,_ as P}from"./index-BAVvkMCM.js";const R={class:"settings-container"},A={class:"card-header"},F=M({__name:"Settings",setup(G){const k={"settings.title":"系统设置","settings.network":"局域网发现 (mDNS)","settings.mdns_enable":"开启广播","settings.mdns_name":"服务名称","settings.tls":"TLS 安全连接","settings.tls_enable":"开启 TLS","settings.tls_port":"端口","common.save":"保存配置"},d=a=>k[a]||a,m=S(!1),s=v({enabled:!1,name:"",port:1883}),e=v({enabled:!1,port:":8883",cert:"",key:""}),f=async()=>{m.value=!0;try{const a=await u.getMdnsConfig();s.enabled=a.data.enabled,s.name=a.data.name,s.port=a.data.port;const t=await u.getTlsConfig();e.enabled=t.data.enabled,e.port=t.data.port||":8883",e.cert=t.data.cert,e.key=t.data.key}catch(a){console.error(a),_.error("获取设置失败")}finally{m.value=!1}},C=async()=>{m.value=!0;try{await u.updateMdnsConfig(s.enabled,s.name),await u.updateTlsConfig(e.enabled,e.port,e.cert,e.key),_.success("配置已更新"),await f()}catch(a){console.error(a),_.error("更新失败: "+(a.response?.data?.error||a.message))}finally{m.value=!1}};return B(()=>{f()}),(a,t)=>{const g=i("el-divider"),V=i("el-switch"),r=i("el-form-item"),c=i("el-input"),E=i("el-button"),T=i("el-form"),h=i("el-card"),x=U("loading");return y(),I("div",R,[l(h,null,{header:n(()=>[w("div",A,[w("span",null,p(d("settings.title")),1)])]),default:n(()=>[N((y(),D(T,{model:s,"label-width":"120px"},{default:n(()=>[l(g,{"content-position":"left"},{default:n(()=>[b(p(d("settings.network")),1)]),_:1}),l(r,{label:d("settings.mdns_enable")},{default:n(()=>[l(V,{modelValue:s.enabled,"onUpdate:modelValue":t[0]||(t[0]=o=>s.enabled=o)},null,8,["modelValue"])]),_:1},8,["label"]),l(r,{label:d("settings.mdns_name")},{default:n(()=>[l(c,{modelValue:s.name,"onUpdate:modelValue":t[1]||(t[1]=o=>s.name=o),disabled:!s.enabled,placeholder:"Mochi MQTT"},null,8,["modelValue","disabled"])]),_:1},8,["label"]),l(g,{"content-position":"left"},{default:n(()=>[b(p(d("settings.tls")),1)]),_:1}),l(r,{label:d("settings.tls_enable")},{default:n(()=>[l(V,{modelValue:e.enabled,"onUpdate:modelValue":t[2]||(t[2]=o=>e.enabled=o)},null,8,["modelValue"])]),_:1},8,["label"]),l(r,{label:d("settings.tls_port")},{default:n(()=>[l(c,{modelValue:e.port,"onUpdate:modelValue":t[3]||(t[3]=o=>e.port=o),disabled:!e.enabled,placeholder:":8883"},null,8,["modelValue","disabled"])]),_:1},8,["label"]),l(r,{label:"Cert (PEM)"},{default:n(()=>[l(c,{modelValue:e.cert,"onUpdate:modelValue":t[4]||(t[4]=o=>e.cert=o),type:"textarea",rows:3,disabled:!e.enabled,placeholder:"-----BEGIN CERTIFICATE-----"},null,8,["modelValue","disabled"])]),_:1}),l(r,{label:"Key (PEM)"},{default:n(()=>[l(c,{modelValue:e.key,"onUpdate:modelValue":t[5]||(t[5]=o=>e.key=o),type:"textarea",rows:3,disabled:!e.enabled,placeholder:"-----BEGIN PRIVATE KEY-----"},null,8,["modelValue","disabled"])]),_:1}),l(r,null,{default:n(()=>[l(E,{type:"primary",onClick:C},{default:n(()=>[b(p(d("common.save")),1)]),_:1})]),_:1})]),_:1},8,["model"])),[[x,m.value]])]),_:1})])}}}),L=P(F,[["__scopeId","data-v-de436c77"]]);export{L as default};
