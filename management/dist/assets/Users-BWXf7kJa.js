import{d as $,r as v,a as h,o as z,c as S,b as w,e as a,w as s,f as n,g as _,E as r,h as j,i as d,t as g,j as A}from"./index-Cun3tfJB.js";const R={style:{"margin-bottom":"20px"}},q={class:"dialog-footer"},H=$({__name:"Users",setup(F){const y=v([]),i=v(!1),u=v(!1),e=h({username:"",password:"",remarks:"",allow:!0,is_admin:!1}),c=async()=>{try{const o=await _.getUsers();y.value=o.data}catch(o){r.error("获取用户列表失败: "+o.message)}},x=()=>{u.value=!1,e.username="",e.password="",e.remarks="",e.allow=!0,e.is_admin=!1,i.value=!0},U=o=>{u.value=!0,e.username=o.username,e.password="",e.remarks=o.remarks||"",e.allow=!o.disallow,e.is_admin=!!o.is_admin,i.value=!0},C=async()=>{if(!e.username){r.warning("用户名必填");return}if(!u.value&&!e.password){r.warning("密码必填");return}try{u.value?(await _.updateUser(e.username,e.password,e.allow,e.remarks,e.is_admin),r.success("用户已更新")):(await _.addUser(e.username,e.password,e.allow,e.remarks,e.is_admin),r.success("用户已添加")),i.value=!1,c()}catch(o){r.error("操作失败: "+o.message)}},B=o=>{A.confirm("确定要删除该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await _.deleteUser(o),r.success("用户已删除"),c()}catch(l){r.error("删除失败: "+l.message)}}).catch(()=>{})};return z(()=>{c()}),(o,l)=>{const p=n("el-button"),m=n("el-table-column"),V=n("el-tag"),E=n("el-table"),D=n("el-card"),b=n("el-input"),f=n("el-form-item"),k=n("el-switch"),M=n("el-form"),N=n("el-dialog");return j(),S("div",null,[l[13]||(l[13]=w("h2",null,"授权管理",-1)),w("div",R,[a(p,{type:"primary",onClick:x},{default:s(()=>[...l[7]||(l[7]=[d("添加用户",-1)])]),_:1})]),a(D,{class:"box-card"},{header:s(()=>[...l[8]||(l[8]=[w("div",{class:"card-header"},[w("span",null,"已注册用户")],-1)])]),default:s(()=>[a(E,{data:y.value,style:{width:"100%"}},{default:s(()=>[a(m,{prop:"username",label:"用户名",width:"180"}),a(m,{prop:"remarks",label:"备注"}),a(m,{label:"角色",width:"120"},{default:s(t=>[a(V,{type:t.row.is_admin?"warning":"info"},{default:s(()=>[d(g(t.row.is_admin?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(m,{label:"类型",width:"180"},{default:s(t=>[d(g(t.row.client?"Client Rule":"User"),1)]),_:1}),a(m,{label:"状态"},{default:s(t=>[a(V,{type:t.row.disallow?"danger":"success"},{default:s(()=>[d(g(t.row.disallow?"禁止":"允许"),1)]),_:2},1032,["type"])]),_:1}),a(m,{fixed:"right",label:"操作",width:"160"},{default:s(t=>[a(p,{type:"primary",size:"small",onClick:T=>U(t.row)},{default:s(()=>[...l[9]||(l[9]=[d("编辑",-1)])]),_:1},8,["onClick"]),a(p,{type:"danger",size:"small",onClick:T=>B(t.row.username)},{default:s(()=>[...l[10]||(l[10]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(N,{modelValue:i.value,"onUpdate:modelValue":l[6]||(l[6]=t=>i.value=t),title:u.value?"编辑用户":"添加用户",width:"30%"},{footer:s(()=>[w("span",q,[a(p,{onClick:l[5]||(l[5]=t=>i.value=!1)},{default:s(()=>[...l[11]||(l[11]=[d("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:C},{default:s(()=>[...l[12]||(l[12]=[d("确定",-1)])]),_:1})])]),default:s(()=>[a(M,{model:e,"label-width":"80px"},{default:s(()=>[a(f,{label:"用户名"},{default:s(()=>[a(b,{modelValue:e.username,"onUpdate:modelValue":l[0]||(l[0]=t=>e.username=t),disabled:u.value,placeholder:"用户名"},null,8,["modelValue","disabled"])]),_:1}),a(f,{label:"密码"},{default:s(()=>[a(b,{modelValue:e.password,"onUpdate:modelValue":l[1]||(l[1]=t=>e.password=t),placeholder:"密码 (不修改请留空)",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(f,{label:"备注"},{default:s(()=>[a(b,{modelValue:e.remarks,"onUpdate:modelValue":l[2]||(l[2]=t=>e.remarks=t),type:"textarea",placeholder:"用户备注信息"},null,8,["modelValue"])]),_:1}),a(f,{label:"管理员"},{default:s(()=>[a(k,{modelValue:e.is_admin,"onUpdate:modelValue":l[3]||(l[3]=t=>e.is_admin=t),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),a(f,{label:"允许访问"},{default:s(()=>[a(k,{modelValue:e.allow,"onUpdate:modelValue":l[4]||(l[4]=t=>e.allow=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{H as default};
